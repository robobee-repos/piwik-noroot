version: '3.1'

services:

  piwik:
    image: erwin82/piwik:latest
    links:
      - mariadb:db
    environment:
      PHP_MAX_EXECUTION_TIME: "600"
      PHP_OPCACHE_MEMORY_CONSUMPTION_MB: 64
      PHP_MEMORY_LIMIT_MB: 64
    volumes:
      - ${ROOT_DIR}/html:/var/www/html

  mariadb:
    image: bitnami/mariadb:latest
    environment:
      ALLOW_EMPTY_PASSWORD: "yes"
      MARIADB_USER: "piwikdb"
      MARIADB_PASSWORD: "te8Laitei5eoJiiceed0aebua7Choo1a"
      MARIADB_DATABASE: "piwikdb"
    volumes:
      - ${ROOT_DIR}/db:/bitnami/mariadb

  nginx:
    image: erwin82/nginx:latest
    ports:
      - 8080:8080
    links:
      - piwik
    volumes:
      - ${NGINX_CONF_DIR}:/nginx-in
      - ${ROOT_DIR}/html:/var/www/html
